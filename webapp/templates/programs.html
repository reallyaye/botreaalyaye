{# webapp/templates/programs.html #}
{% extends "base.html" %}
{% block content %}
  <h2>üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</h2>

  <form method="post" action="/programs/generate">
    <input type="hidden" name="user_id" value="{{ user_id }}">

    <label>–¶–µ–ª—å –ø—Ä–æ–≥—Ä–∞–º–º—ã:<br>
      <select name="goal" id="goal-select">
        {% for g in goals %}
          <option value="{{ g }}">{{ g }}</option>
        {% endfor %}
      </select>
    </label>
    <br><br>

    <label>–¢–∏–ø –ø—Ä–æ–≥—Ä–∞–º–º—ã:<br>
      <select name="p_type" id="type-select">
        {% for t in types %}
          <option value="{{ t }}">{{ t }}</option>
        {% endfor %}
      </select>
    </label>
    <br><br>

    <button type="submit">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
  </form>

  <p><a href="/programs/custom?user_id={{ user_id }}">–ú–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã ‚Üí</a></p>

  <script>
    (function() {
      const goalSelect = document.getElementById('goal-select');
      const typeSelect = document.getElementById('type-select');
      const userId = "{{ user_id }}";

      goalSelect.addEventListener('change', async () => {
        const goal = goalSelect.value;
        try {
          const res = await fetch(`/programs/types?user_id=${userId}&goal=${encodeURIComponent(goal)}`);
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞');
          // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ–ø—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∏–º –Ω–æ–≤—ã–µ
          typeSelect.innerHTML = '';
          data.types.forEach(t => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.textContent = t;
            typeSelect.append(opt);
          });
        } catch (err) {
          console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∏–ø—ã:', err);
        }
      });
    })();
  </script>
{% endblock %}
