{% extends "base.html" %}
{% block title %}Профиль{% endblock %}
{% block content %}
    <h1>Профиль пользователя {{ username }} (ID: {{ user_id }})</h1>
    {% if success %}
        <p class="success">{{ success }}</p>
    {% endif %}
    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}
    <div class="profile-container">
        <div>
            <h2>Ваши данные:</h2>
            <form method="post" action="/profile/update" enctype="multipart/form-data">
                <label>
                    Имя:<br />
                    <input type="text" name="name" value="{{ name }}" required />
                </label>
                <label>
                    Возраст:<br />
                    <input type="number" name="age" value="{{ age }}" min="1" max="120" required />
                </label>
                <label>
                    Рост (см):<br />
                    <input type="number" step="0.1" name="height" value="{{ height }}" min="1" required />
                </label>
                <label>
                    Вес (кг):<br />
                    <input type="number" step="0.1" name="weight" value="{{ weight }}" min="1" required />
                </label>
                <label>
                    Цель:<br />
                    <select name="goal" required>
                        <option value="lose" {% if goal == "lose" %}selected{% endif %}>Сбросить вес</option>
                        <option value="gain" {% if goal == "gain" %}selected{% endif %}>Набрать массу</option>
                        <option value="maintain" {% if goal == "maintain" %}selected{% endif %}>Поддерживать форму</option>
                    </select>
                </label>
                <label>
                    Уровень активности:<br />
                    <select name="activity_level" required>
                        <option value="sedentary" {% if activity_level == "sedentary" %}selected{% endif %}>Сидячий</option>
                        <option value="light" {% if activity_level == "light" %}selected{% endif %}>Легкая активность</option>
                        <option value="moderate" {% if activity_level == "moderate" %}selected{% endif %}>Средняя активность</option>
                        <option value="active" {% if activity_level == "active" %}selected{% endif %}>Высокая активность</option>
                    </select>
                </label>
                <label>
                    Предпочитаемые тренировки (через запятую):<br />
                    <input type="text" name="workout_types" value="{{ workout_types }}" placeholder="Бег, Силовые, Йога" />
                </label>
                <label>
                    Аватар:<br />
                    <input type="file" name="avatar" accept="image/*" />
                </label>
                <button type="submit">Сохранить</button>
            </form>
        </div>
        <div>
            <h2>Ваш прогресс:</h2>
            {% if progress > 0 %}
                <div class="progress-bar" data-progress="{{ progress }}">
                    {{ progress|round }}%
                </div>
                <p>Прогресс к цели: {{ "Достигнута" if progress == 100 else "В процессе" }}</p>
            {% else %}
                <p>Заполните вес, рост и возраст для отображения прогресса.</p>
            {% endif %}
            <h2>История изменений:</h2>
            {% if history %}
                <ul>
                    {% for entry in history[:5] %}
                        <li>{{ entry[0] }}: Имя={{ entry[1] or "Не указано" }}, Вес={{ entry[4] or "Не указан" }} кг, Цель={{ entry[5] or "Не указана" }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>История отсутствует.</p>
            {% endif %}
            {% if avatar_url %}
                <h2>Ваш аватар:</h2>
                <img src="/static/avatars/{{ avatar_url }}" alt="Аватар">
            {% endif %}
        </div>
    </div>
    <script>
        document.querySelectorAll('.progress-bar').forEach(bar => {
            const progress = bar.getAttribute('data-progress');
            bar.style.setProperty('--progress', progress + '%');
        });
    </script>
{% endblock %}