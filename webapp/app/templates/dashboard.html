<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVIII Fitness - Панель управления</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/unified_style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    {% extends "base.html" %}
    
    {% block title %}NOVIII Fitness - Панель управления{% endblock %}
    
    {% block content %}
    <div class="fade-in">
        <div class="row mb-4">
            <div class="col">
                <h1><i class="fas fa-heartbeat"></i> Добро пожаловать, {{ current_user.username }}!</h1>
            </div>
        </div>
        
        <div class="row">
            <div class="col-6 col-sm-12">
                <div class="card">
                    <h3><i class="fas fa-history"></i> Ваши последние действия</h3>
                    {% if user_activities %}
                        <ul class="activity-list">
                            {% for activity in user_activities %}
                                <li class="activity-item">
                                    <div class="activity-icon">
                                        {% if activity.type == 'workout' %}
                                            <i class="fas fa-dumbbell"></i>
                                        {% elif activity.type == 'goal' %}
                                            <i class="fas fa-bullseye"></i>
                                        {% else %}
                                            <i class="fas fa-check-circle"></i>
                                        {% endif %}
                                    </div>
                                    <div class="activity-content">
                                        <p class="activity-text">{{ activity.description }}</p>
                                        <p class="activity-time text-muted">{{ activity.timestamp }}</p>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="empty-state">
                            <p>У вас пока нет активности. Начните тренировку прямо сейчас!</p>
                            <a href="{{ url_for('workouts') }}" class="btn btn-primary">
                                <i class="fas fa-dumbbell"></i> Начать тренировку
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="col-6 col-sm-12">
                <div class="card">
                    <h3><i class="fas fa-trophy"></i> Ваши достижения</h3>
                    <div class="row">
                        <div class="col-4">
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-dumbbell"></i>
                                </div>
                                <div class="stat-card-value">{{ stats.workouts_completed|default(0) }}</div>
                                <div class="stat-card-label">Тренировок завершено</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div class="stat-card-value">{{ stats.calories_burned|default(0) }}</div>
                                <div class="stat-card-label">Калорий сожжено</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-card-value">{{ stats.workout_minutes|default(0) }}</div>
                                <div class="stat-card-label">Минут на тренировки</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <h4>Прогресс к цели</h4>
                        {% if user_goals %}
                            {% for goal in user_goals %}
                                <div class="goal-item mb-2">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>{{ goal.name }}</span>
                                        <span>{{ goal.progress }}%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: {{ goal.progress }}%" aria-valuenow="{{ goal.progress }}" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>У вас пока нет целей. <a href="{{ url_for('add_goal') }}">Добавить цель</a></p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="card mt-3">
                    <h3><i class="fas fa-quote-left"></i> Мотивация дня</h3>
                    <blockquote class="blockquote">
                        <p>"{{ motivation_quote.text }}"</p>
                        <footer class="blockquote-footer">{{ motivation_quote.author|default('Неизвестный автор') }}</footer>
                    </blockquote>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col">
                <div class="card">
                    <h3><i class="fas fa-calculator"></i> Калькулятор калорий</h3>
                    <div class="row">
                        <div class="col-6 col-sm-12">
                            <form id="calorieCalculator" class="mb-3">
                                <div class="form-group">
                                    <label for="weight" class="form-label">Вес (кг)</label>
                                    <input type="number" class="form-control" id="weight" placeholder="Введите ваш вес">
                                </div>
                                <div class="form-group">
                                    <label for="height" class="form-label">Рост (см)</label>
                                    <input type="number" class="form-control" id="height" placeholder="Введите ваш рост">
                                </div>
                                <div class="form-group">
                                    <label for="age" class="form-label">Возраст</label>
                                    <input type="number" class="form-control" id="age" placeholder="Введите ваш возраст">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Пол</label>
                                    <div>
                                        <label class="radio-inline mr-3">
                                            <input type="radio" name="gender" value="male" checked> Мужской
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" name="gender" value="female"> Женский
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="activity" class="form-label">Уровень активности</label>
                                    <select class="form-control" id="activity">
                                        <option value="1.2">Минимальная активность</option>
                                        <option value="1.375">Легкая активность</option>
                                        <option value="1.55" selected>Умеренная активность</option>
                                        <option value="1.725">Высокая активность</option>
                                        <option value="1.9">Экстремальная активность</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Рассчитать</button>
                            </form>
                        </div>
                        <div class="col-6 col-sm-12">
                            <div id="calorieResult" class="text-center" style="display: none;">
                                <h4>Ваша дневная норма калорий:</h4>
                                <div class="calorie-result-value">0</div>
                                <div class="row mt-3">
                                    <div class="col-4">
                                        <div class="calorie-goal">
                                            <h5>Снижение веса</h5>
                                            <div class="calorie-goal-value weight-loss">0</div>
                                            <small class="text-muted">ккал/день</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="calorie-goal">
                                            <h5>Поддержание</h5>
                                            <div class="calorie-goal-value maintenance">0</div>
                                            <small class="text-muted">ккал/день</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="calorie-goal">
                                            <h5>Набор массы</h5>
                                            <div class="calorie-goal-value weight-gain">0</div>
                                            <small class="text-muted">ккал/день</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
    
    {% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calorieForm = document.getElementById('calorieCalculator');
            const calorieResult = document.getElementById('calorieResult');
            
            calorieForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const weight = parseFloat(document.getElementById('weight').value);
                const height = parseFloat(document.getElementById('height').value);
                const age = parseInt(document.getElementById('age').value);
                const gender = document.querySelector('input[name="gender"]:checked').value;
                const activity = parseFloat(document.getElementById('activity').value);
                
                if (isNaN(weight) || isNaN(height) || isNaN(age)) {
                    alert('Пожалуйста, заполните все поля корректно');
                    return;
                }
                
                let bmr;
                if (gender === 'male') {
                    bmr = 88.36 + (13.4 * weight) + (4.8 * height) - (5.7 * age);
                } else {
                    bmr = 447.6 + (9.2 * weight) + (3.1 * height) - (4.3 * age);
                }
                
                const maintenance = Math.round(bmr * activity);
                const weightLoss = Math.round(maintenance * 0.8);
                const weightGain = Math.round(maintenance * 1.15);
                
                document.querySelector('.calorie-result-value').textContent = maintenance;
                document.querySelector('.calorie-goal-value.weight-loss').textContent = weightLoss;
                document.querySelector('.calorie-goal-value.maintenance').textContent = maintenance;
                document.querySelector('.calorie-goal-value.weight-gain').textContent = weightGain;
                
                calorieResult.style.display = 'block';
            });
        });
    </script>
    {% endblock %}
</body>
</html>
